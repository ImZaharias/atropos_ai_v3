{% extends "base.html" %}
{% block content %}
<h2 class="title">Î¤Î¿ ÎÎ®Î¼Î± ÎŸÎ»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ</h2>
<p>Î— Î¼Î¿Î¯ÏÎ± ÏƒÎ¿Ï… Î´ÎµÎ¯Ï‡Î½ÎµÎ¹ Ï„Î¿Î½ Î´ÏÏŒÎ¼Î¿ Ï„Î¿Ï…:</p>
<h1 class="role">{{ role }}</h1>

<p class="muted">Î‘Î¹Ï„Î¹Î¿Î»ÏŒÎ³Î·ÏƒÎ·:</p>
<pre class="panel">{{ reasoning }}</pre>

<div style="margin-top:16px">
  <form id="fb" action="/feedback" method="post">
    <button name="rating" value="1" type="submit">ğŸ‘ Î£Ï…Î¼Ï†Ï‰Î½Ï</button>
    <button name="rating" value="0" type="submit" class="btn-dark">ğŸ‘ Î”Î¹Î±Ï†Ï‰Î½Ï</button>
  </form>
</div>

<script>
document.getElementById('fb').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const fd = new FormData(e.target);
  const res = await fetch('/feedback', {method:'POST', body: fd});
  if(res.ok) alert('Î•Î»Î®Ï†Î¸Î· Ï„Î¿ feedback â€” ÎµÏ…Ï‡Î±ÏÎ¹ÏƒÏ„Ï!');
});
</script>

<hr class="divider">

<button id="toggle-trace" type="button" class="btn-dark">ğŸ§µ Î ÏÏ‚ Î±Ï€Î¿Ï†Î¬ÏƒÎ¹ÏƒÎµ Î· Î‘Ï„ÏÏŒÏ€Î¿Ï‚;</button>
<div id="trace-box" class="trace-box" hidden>
  <h3>ÎŠÏ‡Î½Î¿Ï‚ ÎºÎ±Î½ÏŒÎ½Ï‰Î½ (Î±Î½Î±Î»Ï…Ï„Î¹ÎºÎ¬)</h3>
  <p class="muted">Î”ÎµÏ‚ Ï€Î¿Î¹Î¿Î¹ ÎºÎ±Î½ÏŒÎ½ÎµÏ‚ ÎµÎ½ÎµÏÎ³Î¿Ï€Î¿Î¹Î®Î¸Î·ÎºÎ±Î½ ÏƒÎµ ÎºÎ¬Î¸Îµ ÎµÏÏÏ„Î·ÏƒÎ· ÎºÎ±Î¹ Ï€ÏÏ‚ ÎµÏ€Î·ÏÎ­Î±ÏƒÎ±Î½ Ï„Î· Î²Î±Î¸Î¼Î¿Î»Î¿Î³Î¯Î±.</p>
  <div class="trace-list">
    {% for t in trace %}
      <details class="trace-item">
        <summary><b>{{ t.qid }}</b> Â· ÎºÎ±Î½ÏŒÎ½Î±Ï‚ <code>{{ t.rule_id }}</code></summary>
        <pre class="panel small">{{ t.effects | tojson(indent=2) }}</pre>
      </details>
    {% endfor %}
  </div>
</div>

<script>
(function(){
  const btn = document.getElementById('toggle-trace');
  const box = document.getElementById('trace-box');
  btn.addEventListener('click', ()=>{
    box.hidden = !box.hidden;
    btn.classList.toggle('active', !box.hidden);
    btn.textContent = box.hidden ? "ğŸ§µ Î ÏÏ‚ Î±Ï€Î¿Ï†Î¬ÏƒÎ¹ÏƒÎµ Î· Î‘Ï„ÏÏŒÏ€Î¿Ï‚;" : "âœ–ï¸ ÎšÎ»ÎµÎ¯ÏƒÎµ Ï„Î·Î½ Î±Î½Î¬Î»Ï…ÏƒÎ·";
  });
  {% if show_trace %} box.hidden = false; btn.classList.add('active'); btn.textContent = "âœ–ï¸ ÎšÎ»ÎµÎ¯ÏƒÎµ Ï„Î·Î½ Î±Î½Î¬Î»Ï…ÏƒÎ·"; {% endif %}
})();
</script>

<hr class="divider">
<h3>ÎŸÎ¹ Î±Ï€Î±Î½Ï„Î®ÏƒÎµÎ¹Ï‚ ÏƒÎ¿Ï…</h3>
<ul>
  {% for k, v in answers.items() %}
    <li><b>Î•ÏÏÏ„Î·ÏƒÎ· {{ loop.index }}</b>: {{ v }}</li>
  {% endfor %}
</ul>
{% endblock %}
